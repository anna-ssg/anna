{{define "search"}}
<!-- Overlay search activated with Cmd/Ctrl+K or search icon -->
<div class="search-overlay" id="searchOverlay" aria-hidden="true">
  <div class="search-box" role="dialog" aria-modal="true" aria-label="Search">
    <div class="search-input-row">
      <input id="searchSiteInput" type="text" placeholder="Search posts or pages — fuzzy search" autocomplete="off"
        aria-label="Search site" />
      <button id="closeSearch" class="close-search" aria-label="Close search">✕</button>
    </div>
    <div class="search-hint">Show fuzzy search — try partial words or titles</div>
    <div id="site_search_result" class="search-results"></div>
  </div>
</div>
<script>
  (function () {
    const overlay = document.getElementById('searchOverlay');
    const input = document.getElementById('searchSiteInput');
    const results = document.getElementById('site_search_result');
    const openBtn = document.getElementById('openSearch');
    const closeBtn = document.getElementById('closeSearch');

    function show() { overlay.classList.add('open'); overlay.setAttribute('aria-hidden', 'false'); input.focus(); }
    function hide() { overlay.classList.remove('open'); overlay.setAttribute('aria-hidden', 'true'); input.value = ''; results.innerHTML = ''; }

    document.addEventListener('keydown', function (e) {
      if ((e.key === 'k' || e.key === 'K') && (e.metaKey || e.ctrlKey)) { e.preventDefault(); show(); }
      if (e.key === 'Escape') { hide(); }
    });

    if (openBtn) openBtn.addEventListener('click', function () { show(); });
    if (closeBtn) closeBtn.addEventListener('click', function () { hide(); });
    overlay.addEventListener('click', function (e) { if (e.target === overlay) hide(); });

    // search logic (debounced simple implementation)
    let timeout; input.addEventListener('input', function () {
      clearTimeout(timeout); timeout = setTimeout(() => {
        const q = input.value.trim().toLowerCase(); if (!q) { results.innerHTML = ''; return }
        fetch('/static/index.json').then(r => r.json()).then(data => {
          results.innerHTML = ''; let found = false; for (key in data) { const title = data[key]['Frontmatter']['Title'] || ''; if (title.toLowerCase().includes(q)) { found = true; const a = document.createElement('a'); a.textContent = title; a.href = '/' + data[key]['CompleteURL']; a.className = 'search-link'; results.appendChild(a); results.appendChild(document.createElement('br')); } }
          if (!found) results.textContent = 'No results';
        }).catch(err => { console.error(err); results.textContent = 'Search unavailable' })
      }, 180)
    });
  })();
</script>
{{end}}